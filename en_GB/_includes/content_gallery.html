{% assign gallery = site.galleries | where: "title", page.url | first %}
{% comment %}
  Slugs generated by Netlify CMS can contain Unicode characters which
  is perfectly fine since this works on web for very long
  time. However, Jekyll automatically encodes page.url and we cannot
  sure which is the one used in gallery.title. Therefore, both are
  tried.
{% endcomment %}
{% unless gallery %}
  {% assign iri = page.url | url_decode %}
  {% assign gallery = site.galleries | where: "title", iri | first %}
{% endunless %}
{% if gallery %}
  <div class="clearfix"></div>
  <div class="article-gallery m-top-3">
    <h3>{{ site.data.gallery.content_gallery_title }}</h3>
    <ul class="article-gallery-list">
      {% assign photo_posts = site.posts |
           where_exp: "post", "post.categories contains 'gallery'" |
           where: "gallery", gallery.title %}
      {% for photo in photo_posts %}
        <li class="article-gallery-item img-full">
          {% capture photo_title -%}
            {%- if photo.author %}{% include helpers/author.html author=photo.author %} &ndash; {% endif -%}
            {{ photo.title }}
          {%- endcapture %}
          <a href="{{ photo.image | relative_url }}"
             data-rel="lightcase:gallery"
             class="article-gallery-link"
             title="{{ photo_title }}"
             data-lc-title="{{ photo_title }}">
             <img src="{{ photo.content_thumbnail | default: photo.image | relative_url }}"
                  class="object-fit-cover" data-object-fit="cover"
                  alt="{{ photo.content | markdownify | strip_html}}"/>
          </a>
        </li>
      {% endfor %}
    </ul>
  </div>
{% endif %}
